package com.h3xstream.maven;

import com.h3xstream.maven.tpl.ProjectSummary;
import com.h3xstream.maven.tpl.VulnerableLibrary;
import com.h3xstream.maven.victims.AffectedVersion;
import com.h3xstream.maven.victims.CveVulnerability;
import org.apache.maven.artifact.Artifact;
import org.apache.maven.project.MavenProject;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

public class VulnerabilityFixtures {

    public static List<VulnerableLibrary> libraryList = new ArrayList<VulnerableLibrary>();

    public static List<ProjectSummary> projects = new ArrayList<ProjectSummary>();

    public static CveVulnerability vulnerabilityStruts1;
    static {
        /////// Libraries

        //Mock Artifact
        Artifact a1 = mock(Artifact.class);
        when(a1.getGroupId()).thenReturn("org.apache.struts");
        when(a1.getArtifactId()).thenReturn("struts2-core");
        when(a1.getVersion()).thenReturn("2.1.6");

        //Cve Definition
        List<CveVulnerability> vulnerabilities1 = new ArrayList<CveVulnerability>();
        vulnerabilities1.add(new CveVulnerability(
                "2014-0112",
                "Apache Struts 2: Incomplete fix for ClassLoader manipulation via ParametersInterceptor",
                "ParametersInterceptor in Apache Struts before 2.3.16.2 does not properly restrict access to the getClass method, which allows remote attackers to \"manipulate\" the ClassLoader and execute arbitrary code via a crafted request. NOTE: this vulnerability exists because of an incomplete fix for CVE-2014-0094.",
                "6.4",
                Arrays.asList("https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-0112", "http://struts.apache.org/docs/s2-021.html"),
                Arrays.asList(new AffectedVersion("org.apache.struts:struts2-core",Arrays.asList("<=2.3.16.1")))));
        libraryList.add(new VulnerableLibrary(a1,vulnerabilities1,new ArrayList<Artifact>()));

        vulnerabilityStruts1 = vulnerabilities1.get(0);

        //Mock MavenProject

        MavenProject project = mock(MavenProject.class);
        when(project.getGroupId()).thenReturn("org.test");
        when(project.getArtifactId()).thenReturn("test-project");

        projects.add(new ProjectSummary(project,libraryList));
    }


}
